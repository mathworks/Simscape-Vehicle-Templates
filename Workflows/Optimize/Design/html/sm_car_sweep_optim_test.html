<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Tuning Suspension Hardpoints to Meet Vehicle Performance Metrics</title>
<meta name="generator" content="MATLAB 24.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-08-25">
<meta name="DC.source" content="sm_car_sweep_optim_test.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Tuning Suspension Hardpoints to Meet Vehicle Performance Metrics</h1>
<!--introduction-->
<p>This example tunes suspension hardpoints to minimize the maximum body roll angle during a double-lane change. Using MATLAB scripts you can specify the which hardpoints (such as outboard hardpoint on the upper wishbone) and which coordinates (such as along the x, y, or z axis) should be tuned.</p>
<p>First a sweep is performed to explore the design space. If two coordinates are selected for tuning, a 2D plot will be shown, otherwise a table of the tested values and the resulting performance metric are shown. Next, optimization algorithms are used to find the combination that comes closest to the target value of the selected performance metric.</p>
<p>The documentation below shows the steps performed on sm_car.slx.</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Vehicle Model</a>
</li>
<li>
<a href="#2">Suspension Model</a>
</li>
<li>
<a href="#3">Define Sets of Values for Parameter Sweep</a>
</li>
<li>
<a href="#4">Conduct Parameter Sweep</a>
</li>
<li>
<a href="#5">Display and Plot Performance Metrics Obtained from Sweep</a>
</li>
<li>
<a href="#6">Optimize Selected Hardpoints to Achieve Target Performance Metrics</a>
</li>
</ul>
</div>
<h2 id="1">Vehicle Model</h2>
<p>The model <a href="matlab:open_system('sm_car');">sm_car</a> can be configured to test several different types of suspensions. The suspension type is selected based on field Vehicle.Chassis.SuspA1.Linkage.class.Value within a MATLAB data structure. The locations of the hardpoints are defined within that structure.</p>
<p>
<a href="matlab:open_system('sm_car');">Open Model</a>
</p>
<pre class="codeinput">mdl = <span class="string">'sm_car'</span>;
open_system(mdl)
sm_car_load_vehicle_data(mdl,<span class="string">'064'</span>);
sm_car_config_variants(mdl);
</pre>
<img vspace="5" hspace="5" src="sm_car_sweep_optim_test_01.png" alt=""> <h2 id="2">Suspension Model</h2>
<p>This is the structure of the suspension. The entire suspension is parameterized based on hardpoints. Those hardpoints are defined based on [x y z] locations relative to a common reference point. In the default set of data provided, that reference point is on the ground at the point midway between where the left and right tires touch the ground.</p>
<p>
<a href="matlab:open_system('testrig_quarter_car');open_system('testrig_quarter_car/Linkage/FiveLinkShockFront','force');">Open Subsystem</a>
</p>
<pre class="codeinput">open_system(<span class="string">'sm_car/Vehicle/Vehicle/Chassis/SuspA1/Linkage/Linkage L/FiveLinkShockFront'</span>,<span class="string">'force'</span>);
</pre>
<img vspace="5" hspace="5" src="sm_car_sweep_optim_test_02.png" alt=""> <h2 id="3">Define Sets of Values for Parameter Sweep</h2>
<p>The portion of the design space that will be tested is defined by selecting hardpoint coordinates and a set of values for that coordinate. In this example, we vary the z-coordinate for both ends of the track rod in the steering system. MATLAB will test each combination of values for the two points and plot the result. Any number of coordinates can be used for the sweep, we limited it to two in the example so that we could plot the results as a surface.</p>
<pre class="codeinput">
<span class="comment">% Settings parameters to be swept</span>
<span class="comment">% path2Val is complete path to variable and index in parentheses</span>
par_list(1).path2Val = <span class="string">'Vehicle.Chassis.SuspA1.Linkage.TrackRod.sInboard.Value(3)'</span>;
par_list(1).relRange = -0.04:0.02:0.04;  <span class="comment">% Relative range in m</span>

par_list(2).path2Val = <span class="string">'Vehicle.Chassis.SuspA1.Linkage.TrackRod.sOutboard.Value(3)'</span>;
par_list(2).relRange = -0.04:0.04:0.04;  <span class="comment">% Relative range in m</span>

<span class="keyword">for</span> par_i = 1:length(par_list)
    par_list(par_i).initVal  = eval(par_list(par_i).path2Val);
    par_list(par_i).valueSet = par_list(par_i).initVal + par_list(par_i).relRange;
<span class="keyword">end</span>

<span class="comment">% Set up Maneuver</span>
sm_car_config_maneuver(<span class="string">'sm_car'</span>,<span class="string">'Double Lane Change'</span>);
sim(mdl)
</pre>
<h2 id="4">Conduct Parameter Sweep</h2>
<p>This function will create a simulation input object where each entry has a unique combination of the hardpoint coordinate values specified above. The simulations will be run using the sim() command, and at the end a surface plot shows how the selected performance metric (in this case maximum roll angle) varies with the two coordinate values.</p>
<p>The roll angle versus time is plotted for each test.</p>
<pre class="codeinput">[simInput, simOut] = sm_car_sweep_run(mdl,Vehicle,par_list);
CarMetricsSet = sm_car_sweep_plot_runs(simInput,simOut,<span class="string">'aRoll'</span>);
</pre>
<pre class="codeoutput">[25-Aug-2025 19:12:59] Running simulations...
[25-Aug-2025 19:13:30] Completed 1 of 15 simulation runs
[25-Aug-2025 19:13:48] Completed 2 of 15 simulation runs
[25-Aug-2025 19:14:06] Completed 3 of 15 simulation runs
[25-Aug-2025 19:14:21] Completed 4 of 15 simulation runs
[25-Aug-2025 19:14:37] Completed 5 of 15 simulation runs
[25-Aug-2025 19:14:54] Completed 6 of 15 simulation runs
[25-Aug-2025 19:15:11] Completed 7 of 15 simulation runs
[25-Aug-2025 19:15:27] Completed 8 of 15 simulation runs
[25-Aug-2025 19:15:43] Completed 9 of 15 simulation runs
[25-Aug-2025 19:16:00] Completed 10 of 15 simulation runs
[25-Aug-2025 19:16:15] Completed 11 of 15 simulation runs
[25-Aug-2025 19:16:31] Completed 12 of 15 simulation runs
[25-Aug-2025 19:16:47] Completed 13 of 15 simulation runs
[25-Aug-2025 19:17:04] Completed 14 of 15 simulation runs
[25-Aug-2025 19:17:19] Completed 15 of 15 simulation runs
</pre>
<img vspace="5" hspace="5" src="sm_car_sweep_optim_test_03.png" alt=""> <img vspace="5" hspace="5" src="sm_car_sweep_optim_test_04.png" alt=""> <h2 id="5">Display and Plot Performance Metrics Obtained from Sweep</h2>
<p>The parameter values tested and performance metric are shown in a table. For tests with two performance metrics, a surface plot is shown. The surface plot shows how the performance metric varies as the parameter values are modified.</p>
<pre class="codeinput">disp(<span class="string">'Results of Sweep'</span>);
[SweepTableMxRoll,ax_Ro] = sm_car_sweep_table_plot_metrics(par_list,CarMetricsSet,<span class="string">'Max Roll Angle'</span>);
displayWholeObj(SweepTableMxRoll)

<span class="comment">% Use interpolation to highlight initial point of design</span>
<span class="keyword">if</span>(~isempty(ax_Ro))
    [vHP1, vHP2] = meshgrid(par_list(1).valueSet,par_list(2).valueSet);
    param1 = par_list(1).initVal;
    param2 = par_list(2).initVal;

    <span class="comment">% Obtain performance metric for default design</span>
    qBstr = interp2(vHP1,vHP2,<span class="keyword">...</span>
        reshape(SweepTableMxRoll.(<span class="string">"Max_Roll_Angle"</span>),<span class="keyword">...</span>
        [length(par_list(2).valueSet) length(par_list(1).valueSet)]),<span class="keyword">...</span>
        param1,param2);

    <span class="comment">% Add to plot</span>
    hold <span class="string">on</span>
    plot3(ax_Ro,param1,param2,qBstr,<span class="string">'kd'</span>,<span class="string">'MarkerFaceColor'</span>,<span class="string">'k'</span>,<span class="string">'MarkerSize'</span>,6,<span class="keyword">...</span>
        <span class="string">'DisplayName'</span>,<span class="string">'Initial Design'</span>);
    hold <span class="string">off</span>
    legend(<span class="string">'Location'</span>,<span class="string">'Best'</span>)
<span class="keyword">end</span>
</pre>
<pre class="codeoutput">Results of Sweep

SweepTableMxRoll =

  15&times;4 table

    par_A1TrackRodIn3    par_A1TrackRodOut3    Max_Roll_Angle    Max_Roll_AngleUnits
    _________________    __________________    ______________    ___________________

           0.2                  0.19               1.1949               "deg"       
           0.2                  0.23              0.95997               "deg"       
           0.2                  0.27              0.76403               "deg"       
          0.22                  0.19               1.3101               "deg"       
          0.22                  0.23               1.0706               "deg"       
          0.22                  0.27              0.86736               "deg"       
          0.24                  0.19               1.4168               "deg"       
          0.24                  0.23               1.1768               "deg"       
          0.24                  0.27              0.96862               "deg"       
          0.26                  0.19               1.5133               "deg"       
          0.26                  0.23               1.2795               "deg"       
          0.26                  0.27               1.0663               "deg"       
          0.28                  0.19               1.5957               "deg"       
          0.28                  0.23               1.3755               "deg"       
          0.28                  0.27               1.1611               "deg"       

</pre>
<img vspace="5" hspace="5" src="sm_car_sweep_optim_test_05.png" alt=""> <h2 id="6">Optimize Selected Hardpoints to Achieve Target Performance Metrics</h2>
<p>Now that we have seen the design space, we will use optimization algorithms to identify the coordinates to minimize roll angle. The list of hardpoint coordinates and their ranges are provided to the optimization algorithm. An objective function runs a simulation with those values and computes the performance metrics. After the optimizer converges on values or reaches the limit on the number of iterations permitted, the results are shown and overlaid on the parameter sweep plots.</p>
<p>In this optimization test, the target value for maximum roll angle is supplied.</p>
<pre class="codeinput">metricName    = {<span class="string">'Max Roll Angle'</span>};
tgtValue      = [0];  <span class="comment">% Set to zero, try to minimize</span>
metricWeights = [1];

[xFinal,fval,CarMetrics] = <span class="keyword">...</span>
    sm_car_optim_run(mdl,Vehicle,par_list,metricName,tgtValue,metricWeights);
</pre>
<pre class="codeoutput">Metrics with Initial Set of Parameter Values

ans =

  1&times;4 table

         Names          Values    Units       Description   
    ________________    ______    _____    _________________

    "Max Roll Angle"    1.1768    "deg"    "Body Roll Angle"



Iter     Func-count       f(x)      MeshSize     Method
    0           1        1.17683          0.04      
    1           5        1.12159          0.08     Successful Poll
    2           9        1.01658          0.16     Successful Poll
    3          11        1.01658          0.04     Refine Mesh
    4          15       0.962554          0.08     Successful Poll
    5          18       0.862487          0.16     Successful Poll
    6          20       0.862487          0.04     Refine Mesh
    7          24       0.809325          0.08     Successful Poll
    8          26       0.809325          0.02     Refine Mesh
    9          29         0.7863          0.04     Successful Poll
   10          31         0.7863          0.01     Refine Mesh
   11          34       0.775102          0.02     Successful Poll
   12          36       0.775102         0.005     Refine Mesh
   13          39       0.769556          0.01     Successful Poll
   14          41       0.769556        0.0025     Refine Mesh
   15          44       0.766796         0.005     Successful Poll
   16          45       0.766796       0.00125     Refine Mesh
   17          47       0.765194        0.0025     Successful Poll
   18          48       0.765194      0.000625     Refine Mesh
patternsearch stopped because the mesh size was less than options.MeshTolerance.
Elapsed time for optimization = 820.9107
 
Metrics with Optimized Set of Parameter Values

CarMetricsSummary =

  1&times;6 table

         Names          StartValue    FinalValues    tgtValue    Units       Description   
    ________________    __________    ___________    ________    _____    _________________

    "Max Roll Angle"      1.1768        0.76519         0        "deg"    "Body Roll Angle"


paramSummary =

  2&times;2 table

    Initial     Final 
    _______    _______

     0.24          0.2
     0.23      0.26969

</pre>
<img vspace="5" hspace="5" src="sm_car_sweep_optim_test_06.png" alt=""> <img vspace="5" hspace="5" src="sm_car_sweep_optim_test_07.png" alt=""> <p>The plots below show add the performance metrics from the new design. Values for the hardpoint locations were found that minimize the roll angle during the double-lane change.</p>
<pre class="codeinput">bs_i = find(strcmp(CarMetrics.Names,metricName{1}));

<span class="keyword">if</span>(~isempty(ax_Ro))
    hold(ax_Ro,<span class="string">'on'</span>)
    plot3(ax_Ro,xFinal(1),xFinal(2),CarMetrics.Values(bs_i),<span class="keyword">...</span>
        <span class="string">'rs'</span>,<span class="string">'MarkerSize'</span>,10,<span class="keyword">...</span>
        <span class="string">'DisplayName'</span>,<span class="string">'Tuned Design'</span>);
    hold(ax_Ro,<span class="string">'off'</span>)
<span class="keyword">end</span>
</pre>
<img vspace="5" hspace="5" src="sm_car_sweep_optim_test_08.png" alt=""> <pre class="codeinput">
<span class="comment">%close all</span>
</pre>
<p class="footer">Copyright 2025 The MathWorks, Inc.<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Tuning Suspension Hardpoints to Meet Vehicle Performance Metrics
%
% This example tunes suspension hardpoints to minimize the maximum body
% roll angle during a double-lane change. Using MATLAB scripts you can
% specify the which hardpoints (such as outboard hardpoint on the upper
% wishbone) and which coordinates (such as along the x, y, or z axis)
% should be tuned.
%
% First a sweep is performed to explore the design space. If two
% coordinates are selected for tuning, a 2D plot will be shown, otherwise a
% table of the tested values and the resulting performance metric are
% shown.  Next, optimization algorithms are used to find the combination
% that comes closest to the target value of the selected performance
% metric.
%
% The documentation below shows the steps performed on sm_car.slx.  
%
% Copyright 2025 The MathWorks, Inc.

%% Vehicle Model
%
% The model <matlab:open_system('sm_car'); sm_car> can be configured to
% test several different types of suspensions.  The suspension type is
% selected based on field Vehicle.Chassis.SuspA1.Linkage.class.Value within
% a MATLAB data structure. The locations of the hardpoints are defined
% within that structure.
%
% <matlab:open_system('sm_car'); Open Model>

mdl = 'sm_car';
open_system(mdl)
sm_car_load_vehicle_data(mdl,'064');
sm_car_config_variants(mdl);

%% Suspension Model
%
% This is the structure of the suspension.  The entire suspension is
% parameterized based on hardpoints.  Those hardpoints are defined based on
% [x y z] locations relative to a common reference point.  In the default
% set of data provided, that reference point is on the ground at the
% point midway between where the left and right tires touch the ground.
%
% <matlab:open_system('testrig_quarter_car');open_system('testrig_quarter_car/Linkage/FiveLinkShockFront','force'); Open Subsystem>

open_system('sm_car/Vehicle/Vehicle/Chassis/SuspA1/Linkage/Linkage L/FiveLinkShockFront','force');

%% Define Sets of Values for Parameter Sweep
%
% The portion of the design space that will be tested is defined by
% selecting hardpoint coordinates and a set of values for that coordinate.
% In this example, we vary the z-coordinate for both ends of the track rod
% in the steering system.  MATLAB will test each combination of values for
% the two points and plot the result.  Any number of coordinates can be
% used for the sweep, we limited it to two in the example so that we could
% plot the results as a surface.

% Settings parameters to be swept
% path2Val is complete path to variable and index in parentheses 
par_list(1).path2Val = 'Vehicle.Chassis.SuspA1.Linkage.TrackRod.sInboard.Value(3)';
par_list(1).relRange = -0.04:0.02:0.04;  % Relative range in m

par_list(2).path2Val = 'Vehicle.Chassis.SuspA1.Linkage.TrackRod.sOutboard.Value(3)';
par_list(2).relRange = -0.04:0.04:0.04;  % Relative range in m

for par_i = 1:length(par_list)
    par_list(par_i).initVal  = eval(par_list(par_i).path2Val);
    par_list(par_i).valueSet = par_list(par_i).initVal + par_list(par_i).relRange;
end

% Set up Maneuver
sm_car_config_maneuver('sm_car','Double Lane Change');
sim(mdl)

%% Conduct Parameter Sweep
%
% This function will create a simulation input object where each entry has
% a unique combination of the hardpoint coordinate values specified above.
% The simulations will be run using the sim() command, and at the end a
% surface plot shows how the selected performance metric (in this case
% maximum roll angle) varies with the two coordinate values.
%
% The roll angle versus time is plotted for each test.

[simInput, simOut] = sm_car_sweep_run(mdl,Vehicle,par_list);
CarMetricsSet = sm_car_sweep_plot_runs(simInput,simOut,'aRoll');

%% Display and Plot Performance Metrics Obtained from Sweep
%
% The parameter values tested and performance metric are shown in a table.
% For tests with two performance metrics, a surface plot is shown.
% The surface plot shows how the performance metric varies as the parameter
% values are modified.

disp('Results of Sweep');
[SweepTableMxRoll,ax_Ro] = sm_car_sweep_table_plot_metrics(par_list,CarMetricsSet,'Max Roll Angle');
displayWholeObj(SweepTableMxRoll)

% Use interpolation to highlight initial point of design
if(~isempty(ax_Ro))
    [vHP1, vHP2] = meshgrid(par_list(1).valueSet,par_list(2).valueSet);
    param1 = par_list(1).initVal;
    param2 = par_list(2).initVal;

    % Obtain performance metric for default design
    qBstr = interp2(vHP1,vHP2,...
        reshape(SweepTableMxRoll.("Max_Roll_Angle"),...
        [length(par_list(2).valueSet) length(par_list(1).valueSet)]),...
        param1,param2);

    % Add to plot
    hold on
    plot3(ax_Ro,param1,param2,qBstr,'kd','MarkerFaceColor','k','MarkerSize',6,...
        'DisplayName','Initial Design');
    hold off
    legend('Location','Best')
end

%% Optimize Selected Hardpoints to Achieve Target Performance Metrics
%
% Now that we have seen the design space, we will use optimization
% algorithms to identify the coordinates to minimize roll angle.  The list
% of hardpoint coordinates and their ranges are provided to the
% optimization algorithm.  An objective function runs a simulation with
% those values and computes the performance metrics. After the optimizer
% converges on values or reaches the limit on the number of iterations
% permitted, the results are shown and overlaid on the parameter sweep
% plots.
%
% In this optimization test, the target value for maximum roll angle is
% supplied.

metricName    = {'Max Roll Angle'};
tgtValue      = [0];  % Set to zero, try to minimize
metricWeights = [1];

[xFinal,fval,CarMetrics] = ...
    sm_car_optim_run(mdl,Vehicle,par_list,metricName,tgtValue,metricWeights);

%%
% The plots below show add the performance metrics from the new design.
% Values for the hardpoint locations were found that minimize the roll
% angle during the double-lane change.  

bs_i = find(strcmp(CarMetrics.Names,metricName{1}));

if(~isempty(ax_Ro))
    hold(ax_Ro,'on')
    plot3(ax_Ro,xFinal(1),xFinal(2),CarMetrics.Values(bs_i),...
        'rs','MarkerSize',10,...
        'DisplayName','Tuned Design');
    hold(ax_Ro,'off')
end

%%
%close all
##### SOURCE END #####
-->
</body>
</html>
